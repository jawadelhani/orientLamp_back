services:
  - type: web
    name: orientlamp-backend
    env: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: free
    # Render free plan spins down after 15 min inactivity (cold start ~30-50s)
    envVars:
      # ── Database (Supabase PostgreSQL) ──────────────────────────────────────
      - key: SPRING_DATASOURCE_URL
        sync: false   # Set manually: jdbc:postgresql://db.xxx.supabase.co:5432/postgres
      - key: SPRING_DATASOURCE_USERNAME
        sync: false   # Supabase: postgres
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false   # Your Supabase DB password

      # ── Redis (Upstash) ─────────────────────────────────────────────────────
      - key: SPRING_DATA_REDIS_HOST
        sync: false   # e.g. happy-mouse-12345.upstash.io
      - key: SPRING_DATA_REDIS_PORT
        value: "6379"
      - key: SPRING_DATA_REDIS_PASSWORD
        sync: false   # Your Upstash Redis password
      - key: SPRING_DATA_REDIS_SSL_ENABLED
        value: "true"
      - key: SPRING_DATA_REDIS_REPOSITORIES_ENABLED
        value: "false"

      # ── Mail (Gmail SMTP) ───────────────────────────────────────────────────
      - key: SPRING_MAIL_HOST
        value: smtp.gmail.com
      - key: SPRING_MAIL_PORT
        value: "465"
      - key: SPRING_MAIL_USERNAME
        sync: false   # Your Gmail address
      - key: SPRING_MAIL_PASSWORD
        sync: false   # Your Gmail App Password
      - key: SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH
        value: "true"
      - key: SPRING_MAIL_PROPERTIES_MAIL_SMTP_SSL_ENABLE
        value: "true"
      - key: SPRING_MAIL_PROPERTIES_MAIL_SMTP_SSL_TRUST
        value: smtp.gmail.com

      # ── AI Keys ────────────────────────────────────────────────────────────
      - key: GEMINI_API_KEY
        sync: false
      - key: GROQ_API_KEY
        sync: false

      # ── JWT ────────────────────────────────────────────────────────────────
      - key: JWT_SECRET
        sync: false   # Generate a strong 64-char random string
      - key: JWT_EXPIRATION
        value: "86400000"
      - key: JWT_REFRESH_EXPIRATION
        value: "604800000"
      - key: EMAIL_VERIFICATION_EXPIRATION
        value: "900"

      # ── CORS (your Vercel front end URL) ───────────────────────────────────
      - key: APP_CORS_ALLOWED_ORIGINS
        sync: false   # e.g. https://orientlamp.vercel.app

      # ── App ────────────────────────────────────────────────────────────────
      - key: APP_BASE_URL
        sync: false   # Your Render service URL e.g. https://orientlamp-backend.onrender.com
      - key: APP_UPLOAD_DIR
        value: /app/uploads
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: update
